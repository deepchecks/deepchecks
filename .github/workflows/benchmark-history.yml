# ----------------------------------------------------------------------------
# Copyright (C) 2021-2022 Deepchecks (https://www.deepchecks.com)
#
# This file is part of Deepchecks.
# Deepchecks is distributed under the terms of the GNU Affero General
# Public License (version 3 or later).
# You should have received a copy of the GNU Affero General Public License
# along with Deepchecks.  If not, see <http://www.gnu.org/licenses/>.
# ----------------------------------------------------------------------------
#
name: Benchmark-History

on:
  push:
    branches: [ main ]
  # Manual run
  workflow_dispatch:

env:
  DISABLE_DEEPCHECKS_ANONYMOUS_TELEMETRY: "true"

jobs:
  benchmark-history-tabular:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Setup git user
      run: |
        git config --global user.name "$(git --no-pager log --format=format:'%an' -n 1)"
        git config --global user.email "$(git --no-pager log --format=format:'%ae' -n 1)"
    - name: Set up Python 3.9
      uses: actions/setup-python@v3
      with:
        python-version: "3.9"
    - name: Set Up Env
      run: make env
    - name: pip freeze
      run: make freeze
    - name: Run benchmarks
      run: |
        .github/scripts/benchmark-history.sh benchmarks/tabular

  benchmark-history-vision:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Setup git user
      run: |
        git config --global user.name "$(git --no-pager log --format=format:'%an' -n 1)"
        git config --global user.email "$(git --no-pager log --format=format:'%ae' -n 1)"
    - name: Set up Python 3.9
      uses: actions/setup-python@v3
      with:
        python-version: "3.9"
    - name: Set Up Env
      run: make env
    - name: pip freeze
      run: make freeze
    - name: Run benchmarks
      run: |
        .github/scripts/benchmark-history.sh benchmarks/vision