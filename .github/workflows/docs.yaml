# Workflow to build and publish the documentation
name: Documentation builder

on:
  schedule:
    # Nightly build at 3:42 A.M.
    - cron: "42 3 */1 * *"
  pull_request:
    branches:
      - main
      - "[0-9]+.[0-9]+.X"
  # Manual run
  workflow_dispatch:

jobs:
  # Build the documentation
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout deepchecks
        uses: actions/checkout@v1

      - name: Setup Python
        uses: actions/setup-python@v2
      - name: Set Up Env
        run: make env && make requirements
      - name: Build documentation
        run: make docs

      - name: Upload documentation
        uses: actions/upload-artifact@v2
        with:
          name: docs
          path: docs/build/html

  # Push the documentation
  push:
    runs-on: ubuntu-latest
    needs: [build]
    # if: github.event_name != 'pull_request'
    steps:
      - name: Download documentation
        uses: actions/download-artifact@v2
        with:
          name: docs
          path: docs

      - name: Checkout deepchecks
        uses: actions/checkout@v2
        with:
          path: deepchecks

      - name: Checkout deepchecks.github.io
        uses: actions/checkout@v2
        with:
          repository: deepchecks/deepchecks.github.io
          path: deepchecks.github.io

      - name: Push documentation
        run: deepchecks/.github/scripts/push_docs.sh